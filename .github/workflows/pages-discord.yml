name: Notify Discord for Pages updates

on:
  # 1) Quand tu pushes sur la branche qui dÃ©clenche le dÃ©ploiement
  push:
    branches:
      - multi-pages

  # 2) Quand le workflow auto "pages-build-deployment" se termine
  workflow_run:
    workflows: ["pages-build-deployment"]
    types:
      - completed

jobs:
  notify_start:
    name: Notify update started
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    steps:
      - name: Send Discord notification (updating)
        run: |
          curl -H "Content-Type: application/json" \
          -d '{
            "content": "âš™ï¸ **Mise Ã  jour du site en coursâ€¦**\nğŸ‘¤ `${{ github.actor }}`\nğŸ§© `${{ github.sha }}`\nğŸ“ ${{ toJson(github.event.head_commit.message) }}"
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}

  notify_done:
    name: Notify deployment result
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_run'
    steps:
      - name: Send Discord notification (success)
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        run: |
          curl -H "Content-Type: application/json" \
          -d '{
            "content": "ğŸš€ **GitHub Pages est en ligne !**\nğŸŒ URL : https://${{ github.repository_owner }}.github.io/\nâœ… DÃ©ploiement : `${{ github.event.workflow_run.conclusion }}`"
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}

      - name: Send Discord notification (failure)
        if: ${{ github.event.workflow_run.conclusion != 'success' }}
        run: |
          curl -H "Content-Type: application/json" \
          -d '{
            "content": "âŒ **DÃ©ploiement GitHub Pages en Ã©chec**\nğŸ“¦ Workflow : `${{ github.event.workflow_run.name }}`\nğŸ“Œ Conclusion : `${{ github.event.workflow_run.conclusion }}`"
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
